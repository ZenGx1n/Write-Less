<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.4//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.writeless.dao.MessageDAO">

    <resultMap id="message" type="Message">
        <id property="number" column="number" javaType="Integer"/>
        <result property="createTime" column="create_time" javaType="java.util.Date"/>
        <result property="lastEditTime" column="last_edit_time" javaType="java.util.Date"/>
        <result property="agree" column="agree" javaType="int"/>
        <result property="userId" column="user_id" javaType="Integer"/>
        <result property="status" column="status" javaType="int"/>
        <result property="content" column="content" javaType="String"/>
        <association property="user" column="user_id" javaType="User">
            <id property="id" column="uid" javaType="Integer"/>
            <result property="username" column="uname" javaType="String"/>
            <result property="gender" column="ugender" javaType="String"/>
            <result property="age" column="uage" javaType="int"/>
            <result property="post" column="upost" javaType="String"/>
        </association>
    </resultMap>

    <insert id="insert" parameterType="Message">
        INSERT INTO message (create_time,last_edit_time,agree,content,user_id)
                     VALUES (#{createTime},#{lastEditTime},#{agree},#{content},#{userId})
    </insert>

    <update id="update" parameterType="Message">
        UPDATE message SET last_edit_time=#{lastEditTime},content=#{content}
    </update>

    <delete id="delete" parameterType="Integer">
        DELETE FROM messsge WHERE number=#{number}
    </delete>

    <select id="selectByNum" parameterType="Integer" resultMap="message">
        SELECT m.*,u.id uid,u.username uname,u.gender ugender,u.age uage, u.post upost
        FROM message m LEFT JOIN user u on u.id=m.user_id
        WHERE m.number=#{number}
    </select>

    <select id="selectAll" resultMap="message">
        SELECT m.*,u.id uid,u.username uname,u.gender ugender,u.age uage, u.post upost
        FROM message m LEFT JOIN user u on u.id=m.user_id
        ORDER BY number ASC
    </select>

    <update id="updateByType" parameterType="Message">
        UPDATE message
        <set>
            <if test="agree != null">agree=#{agree}</if>
            <if test="status != null">agree=#{status}</if>
        </set>
        WHERE number=#{number}
    </update>

</mapper>